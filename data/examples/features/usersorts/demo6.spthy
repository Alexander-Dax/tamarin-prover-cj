theory Demo6
begin

builtins: natural-numbers

functions: h: Nat Msg -> Msg [iterated]

rule Create:
    [ Fr(~s) ]
  --[ Start(~s) ]->
    [ Counter(~s, 1:nat)]

rule Hash:
    [ Counter( ~s, x:nat ) ]
  --[ Counter( ~s, x:nat ) ]->
    [ Counter( ~s, (x:nat + 1) ) 
    , Out( h(1:nat, h( x:nat,  ~s )) ) ]

rule Recv:
    [ In( h( x, s ) ) ]
  --[ Recv(x:nat) ]->
    [ ]

lemma TestLemma:
    exists-trace
    "Ex #i . Recv((1 + 1)) @ i"

end
